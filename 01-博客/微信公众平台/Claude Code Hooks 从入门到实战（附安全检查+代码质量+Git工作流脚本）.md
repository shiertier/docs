# Claude Code Hooks ä»å…¥é—¨åˆ°å®æˆ˜ï¼ˆé™„å®‰å…¨æ£€æŸ¥+ä»£ç è´¨é‡+Gitå·¥ä½œæµè„šæœ¬ï¼‰

## æ–‡æ¡£ä¿¡æ¯

- ç«™ç‚¹ï¼šå¾®ä¿¡å…¬ä¼—å¹³å°
- åŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/4_-kul76I_I5_fSmViyz7Q
- å‘å¸ƒæ—¥æœŸï¼š2025-11-04
- ä½œè€…ï¼šéŸ¦ä¸œä¸œ

## æ‘˜è¦

**1) ä¸€å¥è¯æ€»ç»“**
Claude Code Hooks æ˜¯ä¸€ç§åœ¨ç‰¹å®šç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨æ‰§è¡Œè„šæœ¬çš„æœºåˆ¶ï¼Œé€šè¿‡åŒå‘é€šä¿¡å’Œé—­ç¯éªŒè¯å¼ºåˆ¶ AI å®Œæˆæµ‹è¯•ã€æ ¼å¼åŒ–ç­‰æ”¶å°¾å·¥ä½œï¼Œå®ç°å¯¹ AI è¡Œä¸ºçš„ç¡®å®šæ€§æ§åˆ¶ã€‚

**2) æ ¸å¿ƒè¦ç‚¹**
*   **æ ¸å¿ƒæœºåˆ¶**ï¼šHook åœ¨ç‰¹å®šèŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥ï¼Œè‹¥å‘ç°é—æ¼ä¼šå°†å…·ä½“åŸå› åé¦ˆç»™ Claudeï¼Œé©±åŠ¨å…¶è‡ªåŠ¨ä¿®æ­£ç›´è‡³æ£€æŸ¥é€šè¿‡ï¼Œå°†å¤šè½®æ‰‹åŠ¨å¯¹è¯ç®€åŒ–ä¸ºå•è½®é—­ç¯ã€‚
*   **åŒå‘é€šä¿¡åè®®**ï¼šHook é€šè¿‡æ ‡å‡†è¾“å…¥ï¼ˆ`stdin`ï¼‰æ¥æ”¶åŒ…å«å½“å‰çŠ¶æ€çš„ JSON æ•°æ®ï¼›é€šè¿‡é€€å‡ºç ï¼ˆ0 ä¸ºé€šè¿‡ï¼Œ2 ä¸ºå¤±è´¥ï¼‰æˆ–æ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆ`stderr` JSONï¼‰å‘ Claude è¿”å›å†³ç­–ä¸æ‹¦æˆªåŸå› ã€‚
*   **é…ç½®ä¸‰è¦ç´ **ï¼šéœ€åœ¨ `.claude/settings.json` ä¸­å®šä¹‰è§¦å‘æ—¶æœºï¼ˆWhenï¼Œå¦‚ `Stop` ç­‰ 8 ç§äº‹ä»¶ï¼‰ã€é’ˆå¯¹æ“ä½œï¼ˆWhatï¼Œé€šè¿‡ `matcher` åŒ¹é…ç‰¹å®šå·¥å…·ï¼‰å’Œæ‰§è¡ŒåŠ¨ä½œï¼ˆHowï¼ŒæŒ‡å®šæ‰§è¡Œè„šæœ¬ï¼‰ã€‚
*   **ç”Ÿå‘½å‘¨æœŸäº‹ä»¶**ï¼šæ”¯æŒ `SessionStart`ã€`PreToolUse`ã€`PostToolUse`ã€`Stop` ç­‰ 8 ç§äº‹ä»¶ï¼Œè¦†ç›–ä»ä¼šè¯åˆå§‹åŒ–ã€å·¥å…·è°ƒç”¨å‰ååˆ°ä»»åŠ¡å®Œæˆçš„å…¨æµç¨‹ã€‚
*   **å…¸å‹å®æˆ˜åœºæ™¯**ï¼šåŒ…æ‹¬æ‹¦æˆªæ•æ„Ÿæ–‡ä»¶ä¿®æ”¹æˆ–å±é™©å‘½ä»¤ï¼ˆæ¡ˆä¾‹ 1ï¼‰ã€è‡ªåŠ¨æ‰§è¡Œä»£ç æ ¼å¼åŒ–ä¸å•å…ƒæµ‹è¯•ï¼ˆæ¡ˆä¾‹ 2ï¼‰ï¼Œä»¥åŠå¼ºåˆ¶è§„èŒƒ Git æäº¤ä¿¡æ¯ä¸åˆ†æ”¯ç®¡ç†ï¼ˆæ¡ˆä¾‹ 3ï¼‰ã€‚
*   **Skills ä¸ Hooks å¯¹æ¯”**ï¼šSkills æ˜¯å»ºè®®æ€§çš„ï¼ˆä¼ æˆçŸ¥è¯†ï¼Œæ•™ AI æ€ä¹ˆåšå¥½ï¼‰ï¼ŒHooks æ˜¯å¼ºåˆ¶æ€§ã€ç¡®å®šæ€§çš„ï¼ˆç‰©ç†æ‹¦æˆªï¼Œå¼ºåˆ¶ AI å¿…é¡»åšå¯¹ï¼‰ï¼Œä¸¤è€…å¸¸é…åˆä½¿ç”¨ã€‚
*   **æ¨¡å‹é€‰å‹ç­–ç•¥**ï¼šå»ºè®®å…ˆç”¨é¡¶çº§æ¨¡å‹ï¼ˆå¦‚ Claude Sonnet 4.5ï¼‰éªŒè¯ä¸šåŠ¡å‡†ç¡®åº¦ä¸Šé™ï¼Œå†è¿›è¡Œé€Ÿåº¦ä¼˜åŒ–ï¼Œæœ€åé€šè¿‡å¤§å°æ¨¡å‹åˆ†å±‚æœåŠ¡æ§åˆ¶æˆæœ¬ã€‚

**3) é£é™©ä¸ä¸è¶³**
*   **æ— é™å¾ªç¯é£é™©**ï¼šHook æœºåˆ¶åœ¨å¤±è´¥é‡è¯•æ—¶å¯èƒ½å¯¼è‡´æ­»å¾ªç¯ï¼Œéœ€ä¾èµ–è¾“å…¥ JSON ä¸­çš„ `stop_hook_active` æ ‡å¿—è¿›è¡Œæ§åˆ¶ï¼ˆé¦–æ¬¡å¯é˜»æ­¢ï¼Œç¬¬äºŒæ¬¡å¿…é¡»æ”¾è¡Œï¼‰ã€‚
*   **å±é™©æ“ä½œé£é™©**ï¼šClaude åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ„å¤–ä¿®æ”¹æ•æ„Ÿæ–‡ä»¶ï¼ˆå¦‚ `.env`ã€å¯†é’¥ï¼‰æˆ–æ‰§è¡Œå±é™©å‘½ä»¤ï¼ˆå¦‚ `rm -rf`ï¼‰ï¼Œå¿…é¡»ä¾èµ– Hook æœºåˆ¶è¿›è¡Œç¡¬æ‹¦æˆªã€‚
*   **æ¨¡å‹é€‰å‹è¯¯åŒº**ï¼šç›´æ¥ä½¿ç”¨å°å°ºå¯¸å¼€æºæ¨¡å‹åš POCï¼ˆæ¦‚å¿µéªŒè¯ï¼‰ï¼Œå®¹æ˜“é™·å…¥æ— æ³•åŒºåˆ†â€œæ¨¡å‹èƒ½åŠ›ä¸è¶³â€è¿˜æ˜¯â€œæŠ€æœ¯æ–¹æ¡ˆæœ‰é—®é¢˜â€çš„å›°å±€ï¼Œä»è€Œæµªè´¹å¤§é‡è°ƒè¯•æ—¶é—´ã€‚

## æ­£æ–‡

åœ¨æ—¥å¸¸çš„ AI ç¼–ç¨‹å®è·µä¸­ï¼ŒClaude Code çš„ä»£ç èƒ½åŠ›æœ‰ç›®å…±ç¹ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šå‡ºç°â€œè™å¤´è›‡å°¾â€çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œæ–°å¼€å‘çš„åŠŸèƒ½æˆ–ä¿®æ”¹çš„å†…å®¹çœ‹ä¼¼å®Œæ•´å®ç°äº†ï¼Œä½† Claude Code å¯èƒ½æ²¡æœ‰ä¸»åŠ¨è¿›è¡Œæµ‹è¯•ï¼Œæˆ–è€…å¿˜è®°æ›´æ–°ç›¸å…³æ–‡æ¡£ã€‚è¿™å¯¼è‡´å‘ç°é—®é¢˜åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰‹åŠ¨ä¸å®ƒè¿›è¡Œå¤šæ¬¡äº¤äº’ã€‚è¿™å¯ä»¥è¯´æ˜¯ AI ç¼–ç¨‹çš„â€œæœ€åä¸€å…¬é‡Œâ€é—®é¢˜ã€‚

æœ‰æœ‹å‹åœ¨çŸ¥è¯†æ˜Ÿçƒä¼šå‘˜ç¾¤ä¸­é—®åˆ°ï¼šå¦‚ä½•ä½¿ç”¨ Stop Hook è®© Claude ä¸æ‰“æ–­å½“å‰å·¥ä½œï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œæ”¶å°¾ä»»åŠ¡ï¼Ÿ

æœ¬æ–‡å°†è¯¦ç»†æ‹†è§£ Claude Code Hook çš„è¿è¡Œæœºåˆ¶ã€é…ç½®ä¸‰è¦ç´ ï¼Œå¹¶æä¾›ä¸‰ä¸ªå®ç”¨çš„ Hook è„šæœ¬æ¡ˆä¾‹ï¼Œæ•™ä½ å¦‚ä½•ä¼˜é›…åœ°è§£å†³æ­¤ç±»é—®é¢˜ã€‚

### ä¸€ã€ Claude Code Hook å¿«é€Ÿæ‰«ç›²

ä¸€å¥è¯æ€»ç»“ï¼š**Claude Code Hooks æ˜¯åœ¨ Claude Code ç‰¹å®šæ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œçš„è„šæœ¬ï¼Œè®©ä½ èƒ½å¯¹å®ƒçš„è¡Œä¸ºè¿›è¡Œç¡®å®šæ€§æ§åˆ¶ã€‚**

#### 1. æ ¸å¿ƒæœºåˆ¶
Hook ä¼šåœ¨ Claude è®¤ä¸ºä»»åŠ¡å®Œæˆæ—¶è‡ªåŠ¨ä»‹å…¥ï¼Œæ‰§è¡Œé¢„è®¾çš„æ£€æŸ¥è„šæœ¬ï¼ˆä¾‹å¦‚ï¼šæµ‹è¯•æ˜¯å¦é€šè¿‡ã€ä»£ç æ˜¯å¦æ ¼å¼åŒ–ã€Changelog æ˜¯å¦æ›´æ–°ã€æ˜¯å¦åˆ›å»º PR ç­‰ï¼‰ã€‚
*   å¦‚æœå…¨éƒ¨å®Œæˆï¼Œåˆ™ä»»åŠ¡çœŸæ­£ç»“æŸã€‚
*   å¦‚æœå‘ç°é—æ¼ï¼ŒHook ä¼šæŠŠå…·ä½“çš„ç¼ºå¤±é¡¹åé¦ˆç»™ Claudeã€‚Claude èƒ½å¤Ÿç†è§£è¿™äº›åé¦ˆå¹¶è‡ªåŠ¨è¡¥å……æ”¶å°¾å·¥ä½œã€‚è¡¥å……åï¼ŒHook ä¼šå†æ¬¡æ£€æŸ¥ï¼Œå½¢æˆé—­ç¯ï¼Œç›´åˆ°æ‰€æœ‰æ”¶å°¾å·¥åºå®Œæˆã€‚

#### 2. ä»·å€¼å¯¹æ¯”
*   **æ²¡æœ‰ Hookï¼ˆéœ€è¦ 5 è½®å¯¹è¯ï¼‰ï¼š** ä½ è¯´"é‡æ„ç”¨æˆ·æ¨¡å—" â†’ Claude å®Œæˆä»£ç  â†’ ä½ è¯´"è¿è¡Œæµ‹è¯•" â†’ ä½ è¯´"æ ¼å¼åŒ–ä»£ç " â†’ ä½ è¯´"æ›´æ–° Changelog" â†’ ä½ è¯´"åˆ›å»º PR"ã€‚
*   **æœ‰ Hookï¼ˆ1 è½®å¯¹è¯å®Œæˆï¼‰ï¼š** ä½ è¯´"é‡æ„ç”¨æˆ·æ¨¡å—" â†’ Claude å®Œæˆä»£ç  â†’ Hook è‡ªåŠ¨å‘ç°ç¼ºå°‘æµ‹è¯•ã€æ ¼å¼åŒ–ã€Changelog â†’ Claude è‡ªåŠ¨è¡¥å…¨æ‰€æœ‰æ”¶å°¾å·¥åº â†’ Hook ç¡®è®¤é€šè¿‡ã€‚ä¸»æ‰“ä¸€ä¸ªé è°±ã€‚

---

### äºŒã€ Hook è¿è¡Œæœºåˆ¶æ‹†è§£

Hook è„šæœ¬å¹¶ä¸æ˜¯ç®€å•çš„å‘½ä»¤æ‰§è¡Œï¼Œè€Œæ˜¯ä¸€ä¸ª**åŒå‘é€šä¿¡è¿‡ç¨‹**ï¼šClaude Code å‘Šè¯‰ Hook å½“å‰çŠ¶æ€ï¼ŒHook æ£€æŸ¥åè¿”å›å†³å®šï¼Œå‘Šè¯‰ Claude Code æ˜¯ç»§ç»­è¿˜æ˜¯é˜»æ­¢ï¼Œä»¥åŠå…·ä½“åŸå› ã€‚

#### 1. é€šä¿¡æµç¨‹ä¸å‚ä¸æ–¹
æ•´ä¸ªè¿‡ç¨‹åŒ…å« 4 ä¸ªå…³é”®å‚ä¸æ–¹ï¼š
*   **ä½ **ï¼šå‘èµ·ä»»åŠ¡ã€‚
*   **Claude Code**ï¼šç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œè§¦å‘ Hookã€‚
*   **Hook è„šæœ¬**ï¼šæ‰§è¡Œæ£€æŸ¥é€»è¾‘ã€‚
*   **Claude AI**ï¼šç†è§£åé¦ˆå¹¶ä¿®æ­£ã€‚

**æˆåŠŸè·¯å¾„ï¼š**
1. Stop äº‹ä»¶è§¦å‘åï¼ŒClaude Code å‘é€å½“å‰çŠ¶æ€ç»™ Hook è„šæœ¬ï¼ˆé€šè¿‡ stdin JSONï¼‰ã€‚
2. Hook è¿è¡Œæ£€æŸ¥ï¼ˆæµ‹è¯•ã€æ ¼å¼åŒ–ç­‰ï¼‰ã€‚
3. æ£€æŸ¥é€šè¿‡ï¼Œè¿”å› `exit code 0`ï¼Œä»»åŠ¡å®Œæˆã€‚

**å¤±è´¥è·¯å¾„ï¼š**
1. Hook æ£€æŸ¥å‘ç°é—®é¢˜ã€‚
2. è¿”å› `exit code 2` + JSON å¤±è´¥åŸå› ï¼ˆé€šè¿‡ stderrï¼‰ã€‚
3. Claude Code å°†å¤±è´¥åŸå› æ˜¾ç¤ºç»™ Claude AIã€‚
4. Claude AI ç†è§£é—®é¢˜å¹¶ä¿®æ­£ï¼Œç»§ç»­å·¥ä½œï¼Œå†æ¬¡è§¦å‘ Stop Hookã€‚
5. æ­¤æ—¶ `stop_hook_active: true`ï¼ŒHook å†æ¬¡æ£€æŸ¥ã€‚é€šè¿‡åè¿”å› `exit code 0`ï¼Œä»»åŠ¡å®Œæˆã€‚
*(æ³¨æ„ï¼š`stop_hook_active` æ ‡å¿—ç”¨äºé˜²æ­¢æ— é™å¾ªç¯ï¼Œç¬¬ä¸€æ¬¡å¯ä»¥é˜»æ­¢ï¼Œç¬¬äºŒæ¬¡å¿…é¡»æ”¾è¡Œã€‚)*

#### 2. è¾“å…¥ï¼šHook æ¥æ”¶ä»€ä¹ˆä¿¡æ¯ï¼Ÿ
Hook è„šæœ¬é€šè¿‡ `stdin`ï¼ˆæ ‡å‡†è¾“å…¥ï¼‰æ¥æ”¶ JSON æ ¼å¼çš„å½“å‰çŠ¶æ€ï¼š

```python
import json
import sys

# è¯»å– Claude Code ä¼ æ¥çš„çŠ¶æ€
input_data = json.loads(sys.stdin.read())
```

**JSON å†…å®¹ç¤ºä¾‹ä¸å…³é”®å­—æ®µï¼š**
```json
{
  "session_id": "abc123",
  "stop_hook_active": false,  // å…³é”®ï¼šé˜²æ­¢æ— é™å¾ªç¯ã€‚false=å¯ä»¥é˜»æ­¢ï¼Œtrue=å¿…é¡»æ”¾è¡Œ
  "tool_name": "Write",       // è§¦å‘çš„å·¥å…·ï¼Œç”¨äºåˆ¤æ–­æ˜¯ä»€ä¹ˆæ“ä½œ
  "tool_input": {             // å·¥å…·å‚æ•°ï¼Œè·å–å…·ä½“æ‰§è¡Œå†…å®¹
    "file_path": "src/main.py",
    "content": "..."
  },
  "tool_response": "..."      // å·¥å…·ç»“æœï¼ˆPostToolUse æ—¶å¯ç”¨ï¼‰
}
```

#### 3. è¾“å‡ºï¼šHook å¦‚ä½•è¿”å›å†³å®šï¼Ÿ
Hook è„šæœ¬é€šè¿‡ä¸¤ç§æ–¹å¼å‘Šè¯‰ Claude Code æ£€æŸ¥ç»“æœï¼š

**æ–¹å¼ 1ï¼šé€€å‡ºç ï¼ˆç®€å•ç‰ˆï¼‰**
```python
import sys

# âœ… æ£€æŸ¥é€šè¿‡
sys.exit(0)

# âŒ æ£€æŸ¥å¤±è´¥ï¼Œé˜»æ­¢å¹¶åé¦ˆ
sys.exit(2)  # stderr çš„å†…å®¹ä¼šå‘é€ç»™ Claude AI
```

**æ–¹å¼ 2ï¼šJSON å“åº”ï¼ˆç²¾ç»†ç‰ˆï¼‰**
é€šè¿‡ `stderr`ï¼ˆæ ‡å‡†é”™è¯¯è¾“å‡ºï¼‰è¿”å› JSONï¼Œå®ç°æ›´ç²¾ç»†çš„æ§åˆ¶ï¼š
```python
import json
import sys

response = {
    "decision": "block",           # é˜»æ­¢ç»§ç»­ (PreToolUse / Stop é€‚ç”¨)
    "reason": "æµ‹è¯•å¤±è´¥: test_login", # â­ Claude ä¼šè¯»å–å¹¶ç†è§£
    "continue": False,             # false=åœæ­¢æ‰€æœ‰å¤„ç†
    "suppressOutput": False        # éšè— stdout è¾“å‡º
}

print(json.dumps(response, ensure_ascii=False), file=sys.stderr)
sys.exit(2)
```
*(å¤‡æ³¨ï¼š`stdout` è¾“å‡ºäººç±»å¯è¯»çš„æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼›`stderr` è¾“å‡ºæœºå™¨å¯è¯»çš„åé¦ˆï¼Œä¾› Claude AI å¤„ç†ã€‚)*

---

### ä¸‰ã€ Hook é…ç½®ä¸‰è¦ç´ æ¢³ç†

ä¸€ä¸ªå®Œæ•´çš„ Hook é…ç½®éœ€è¦å›ç­”ä¸‰ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™è§¦å‘ï¼ˆWhenï¼‰ã€é’ˆå¯¹ä»€ä¹ˆæ“ä½œï¼ˆWhatï¼‰ã€è¿è¡Œä»€ä¹ˆè„šæœ¬ï¼ˆHowï¼‰ã€‚

#### 1. äº‹ä»¶ç±»å‹ï¼ˆWhen - ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼‰
Claude Code ç›®å‰æ”¯æŒ 8 ç§ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼š

| äº‹ä»¶ | è§¦å‘æ—¶æœº | å…¸å‹ç”¨é€” |
| :--- | :--- | :--- |
| **SessionStart** | ä¼šè¯å¼€å§‹ | åŠ è½½é¡¹ç›®ä¸Šä¸‹æ–‡ã€åˆå§‹åŒ–ç¯å¢ƒ |
| **UserPromptSubmit** | ç”¨æˆ·æäº¤æç¤ºè¯å‰ | æ³¨å…¥é¢å¤–ä¿¡æ¯ã€éªŒè¯è¾“å…¥ |
| **PreToolUse** | å·¥å…·æ‰§è¡Œå‰ | é˜»æ­¢å±é™©å‘½ä»¤ã€å‚æ•°æ ¡éªŒ |
| **PostToolUse** | å·¥å…·æ‰§è¡Œå | è‡ªåŠ¨æ ¼å¼åŒ–ã€è¿è¡Œ linter |
| **Notification** | AI å‘é€é€šçŸ¥æ—¶ | è‡ªå®šä¹‰æé†’ã€æ—¥å¿—è®°å½• |
| **Stop** | AI å®Œæˆå“åº”æ—¶ | ç¡®ä¿æ”¶å°¾å·¥ä½œã€è´¨é‡é—¨æ§› |
| **SubagentStop** | å­ä»»åŠ¡å®Œæˆæ—¶ | å­ä»»åŠ¡éªŒè¯ã€ç»“æœä¸²è” |
| **PreCompact** | ä¸Šä¸‹æ–‡å‹ç¼©å‰ | ä¿å­˜å®Œæ•´å†å²ã€å¤‡ä»½çŠ¶æ€ |

#### 2. è§¦å‘æ¡ä»¶ï¼ˆWhat - é’ˆå¯¹ä»€ä¹ˆæ“ä½œï¼‰
å¯ä»¥ä½¿ç”¨ `matcher` ç²¾ç¡®æ§åˆ¶å“ªäº›å·¥å…·è°ƒç”¨ä¼šè§¦å‘ Hookï¼ˆä»…é€‚ç”¨äº `PreToolUse` å’Œ `PostToolUse` äº‹ä»¶ï¼Œ`Stop` ç­‰äº‹ä»¶ä¸éœ€è¦ï¼‰ï¼š

```json
{
  "matcher": "Bash",           // åªé’ˆå¯¹ Bash å‘½ä»¤
  "matcher": "Write|Edit",     // é’ˆå¯¹æ–‡ä»¶å†™å…¥æˆ–ç¼–è¾‘
  "matcher": "*",              // é’ˆå¯¹æ‰€æœ‰å·¥å…·
  "matcher": ""                // é’ˆå¯¹æ‰€æœ‰
}
```

#### 3. æ‰§è¡ŒåŠ¨ä½œï¼ˆHow - åšä»€ä¹ˆï¼‰
æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬æˆ–å‘½ä»¤ï¼ˆæ”¯æŒ Python è„šæœ¬ `.py`ã€Shell è„šæœ¬ `.sh` æˆ–ä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼š

```json
{
  "type": "command",
  "command": "python3 .claude/hooks/my_hook.py"
}
```

#### 4. å®Œæ•´é…ç½®ç¤ºä¾‹
å°†ä»¥ä¸Šä¸‰è¦ç´ ç»„åˆï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `.claude/settings.json` ä¸­é…ç½®å¦‚ä¸‹ï¼š

```json
{
  "hooks": {
    "Stop": [                               // 1ï¸âƒ£ äº‹ä»¶ç±»å‹
      {
        "hooks": [                          // 2ï¸âƒ£ Stop ä¸éœ€è¦ matcher
          {
            "type": "command",              // 3ï¸âƒ£ æ‰§è¡ŒåŠ¨ä½œ
            "command": "python3 .claude/hooks/stop_check.py"
          }
        ]
      }
    ],
    "PreToolUse": [                         // å¦ä¸€ä¸ªä¾‹å­
      {
        "matcher": "Bash",                  // 2ï¸âƒ£ åªé’ˆå¯¹ Bash å‘½ä»¤
        "hooks": [
          {
            "type": "command",              // 3ï¸âƒ£ æ‰§è¡ŒåŠ¨ä½œ
            "command": "python3 .claude/hooks/bash_check.py"
          }
        ]
      }
    ]
  }
}
```
*(é…ç½®è¯´æ˜ï¼šé…ç½®æ–‡ä»¶ä½äº `.claude/settings.json`ï¼›Hook è„šæœ¬çº¦å®šä¿—æˆæ”¾åœ¨ `.claude/hooks/` ç›®å½•ä¸‹ï¼›è·¯å¾„æ¨èä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæ–¹ä¾¿é¡¹ç›®åˆ†äº«ã€‚)*

---

### å››ã€ ä¸‰ä¸ªå®æˆ˜æ¡ˆä¾‹

ä»¥ä¸‹æä¾›ä¸‰ä¸ªå¸¸è§ç”¨ä¾‹ã€‚æ–°æ‰‹å»ºè®®ä»æ¡ˆä¾‹ 1 å¼€å§‹ï¼Œæ¡ˆä¾‹ 2 èƒ½å¤Ÿæ˜¾è‘—æå‡ä»£ç è´¨é‡ï¼Œæ¡ˆä¾‹ 3 åˆ™éå¸¸é€‚åˆä¼ä¸šçº§å·¥ä½œæµã€‚*(æ³¨ï¼šå—ç¯‡å¹…é™åˆ¶ï¼Œæ­¤å¤„å±•ç¤ºæ ¸å¿ƒé€»è¾‘ï¼Œå®Œæ•´è„šæœ¬ä»£ç è§çŸ¥è¯†æ˜Ÿçƒ)*

#### æ¡ˆä¾‹ 1: é˜»æ­¢å±é™©æ“ä½œ
Claude å¯èƒ½ä¼šä¸å°å¿ƒä¿®æ”¹æ•æ„Ÿæ–‡ä»¶ï¼ˆå¦‚ `.env`ã€å¯†é’¥æ–‡ä»¶ï¼‰ï¼Œæˆ–æ‰§è¡Œå±é™©å‘½ä»¤ï¼ˆå¦‚ `rm -rf`ï¼‰ã€‚æ­¤ Hook ä½¿ç”¨ `matcher` åœ¨ç›¸å…³å·¥å…·ä¸Šè§¦å‘ï¼Œä¸ä»…é˜»æ­¢å±é™©æ“ä½œï¼Œè¿˜èƒ½æä¾›æ›¿ä»£æ–¹æ¡ˆã€‚

**Hook é…ç½® (`.claude/settings.json`)ï¼š**
```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit|Write|MultiEdit",
        "hooks": [{"type": "command", "command": "python3 .claude/hooks/security_check.py"}]
      },
      {
        "matcher": "Bash",
        "hooks": [{"type": "command", "command": "python3 .claude/hooks/security_check.py"}]
      }
    ]
  }
}
```

**Hook è„šæœ¬æ ¸å¿ƒé€»è¾‘ (`.claude/hooks/security_check.py`)ï¼š**
```python
#!/usr/bin/env python3
import json
import sys

def check_sensitive_files(file_path):
    """æ£€æŸ¥æ˜¯å¦ä¸ºæ•æ„Ÿæ–‡ä»¶"""
    SENSITIVE_FILES = [".env", "secrets.yaml", "private_key.pem", ".ssh/id_rsa"]
    for sensitive in SENSITIVE_FILES:
        if sensitive in file_path:
            return False, f"ğŸš« ç¦æ­¢ä¿®æ”¹æ•æ„Ÿæ–‡ä»¶: {file_path}"
    return True, None

def check_dangerous_commands(command):
    """æ£€æŸ¥å±é™©å‘½ä»¤"""
    DANGEROUS_PATTERNS = ["rm -rf /", "rm -rf /*", "> /dev/sda", "chmod -R 777 /"]
    for pattern in DANGEROUS_PATTERNS:
        if pattern in command:
            return False, f"ğŸš« ç¦æ­¢æ‰§è¡Œå±é™©å‘½ä»¤: {command}"
    return True, None
```
*(åˆ«å¿˜äº†æ·»åŠ æ‰§è¡Œæƒé™ï¼š`chmod +x .claude/hooks/security_check.py`)*

#### æ¡ˆä¾‹ 2: è‡ªåŠ¨æ ¼å¼åŒ– + æµ‹è¯•æ£€æŸ¥
Claude å®Œæˆä»£ç åç»å¸¸å¿˜è®°æ ¼å¼åŒ–å’Œè¿è¡Œæµ‹è¯•ã€‚æ­¤æ¡ˆä¾‹ä½¿ç”¨ `PostToolUse` è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œå¹¶ç”¨ `Stop` è¿›è¡Œå…¨é¢æ£€æŸ¥ã€‚

**Hook é…ç½® (`.claude/settings.json`)ï¼š**
```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write|MultiEdit",
        "hooks": [{"type": "command", "command": "python3 .claude/hooks/auto_format.py"}]
      }
    ],
    "Stop": [
      {
        "hooks": [{"type": "command", "command": "python3 .claude/hooks/quality_check.py"}]
      }
    ]
  }
}
```

**è´¨é‡æ£€æŸ¥è„šæœ¬æ ¸å¿ƒé€»è¾‘ (`.claude/hooks/quality_check.py`)ï¼š**
```python
#!/usr/bin/env python3
import subprocess
import sys

def run_tests():
    """è¿è¡Œæµ‹è¯•å¥—ä»¶"""
    result = subprocess.run(["python3", "-m", "pytest", "-v"], capture_output=True, text=True, timeout=60)
    if result.returncode == 0:
        return True, "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡"
    else:
        failed = [line for line in result.stdout.split('\n') if 'FAILED' in line]
        return False, f"âŒ æµ‹è¯•å¤±è´¥\n" + "\n".join(failed[:5])

def check_format():
    """æ£€æŸ¥ä»£ç æ ¼å¼"""
    result = subprocess.run(["python3", "-m", "black", "--check", "src/"], capture_output=True, timeout=30)
    return result.returncode == 0, "âœ… æ ¼å¼è§„èŒƒ" if result.returncode == 0 else "âŒ éœ€è¦æ ¼å¼åŒ–"
```

#### æ¡ˆä¾‹ 3: Git æäº¤å·¥ä½œæµ - å®Œæ•´è´¨é‡é—¨æ§›
åœ¨å›¢é˜Ÿåä½œä¸­ï¼Œä»£ç æäº¤å‰éœ€è¦é€šè¿‡å¤šé¡¹æ£€æŸ¥ã€‚æ­¤æ¡ˆä¾‹å¼ºåˆ¶è¦æ±‚ Conventional Commits æ ¼å¼ï¼Œç¦æ­¢ç›´æ¥æäº¤åˆ° main/master åˆ†æ”¯ã€‚

**Hook é…ç½® (`.claude/settings.json`)ï¼š**
```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [{"type": "command", "command": "python3 .claude/hooks/pre_commit.py"}]
      }
    ],
    "Stop": [
      {
        "hooks": [{"type": "command", "command": "python3 .claude/hooks/final_check.py"}]
      }
    ]
  }
}
```

**æäº¤å‰æ£€æŸ¥è„šæœ¬æ ¸å¿ƒé€»è¾‘ (`.claude/hooks/pre_commit.py`)ï¼š**
```python
#!/usr/bin/env python3
import re
import subprocess

def check_commit_message(command):
    """æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼ï¼ˆConventional Commitsï¼‰"""
    match = re.search(r'-m\s+["\'](.+?)["\']', command)
    if not match:
        return True, None

    message = match.group(1)
    pattern = r'^(feat|fix|docs|style|refactor|test|chore)(\(.+?\))?: .{3,}'
    if not re.match(pattern, message):
        return False, (f"âŒ æäº¤ä¿¡æ¯ä¸ç¬¦åˆè§„èŒƒ\nå½“å‰ï¼š{message}\nè¦æ±‚ï¼štype(scope): subject")
    return True, None

def check_branch():
    """æ£€æŸ¥å½“å‰åˆ†æ”¯"""
    result = subprocess.run(["git", "branch", "--show-current"], capture_output=True, text=True)
    branch = result.stdout.strip()
    if branch in ["main", "master", "production"]:
        return False, f"âŒ ç¦æ­¢ç›´æ¥æäº¤åˆ° {branch} åˆ†æ”¯"
    return True, None
```

---

### äº”ã€ å†™åœ¨æœ€å

#### 1. Skills VS Hooks
Claude Skills å’Œ Hooks çš„å®šä½å®Œå…¨ä¸åŒï¼š
*   **Skills æ˜¯æ•™ Claude "æ€ä¹ˆåšå¥½"**ï¼šé€šè¿‡ Markdown æ–‡æ¡£ä¼ æˆé¢†åŸŸçŸ¥è¯†ã€å·¥ä½œæµç¨‹ã€æœ€ä½³å®è·µï¼ŒClaude ä¼šè‡ªåŠ¨åˆ¤æ–­ä½•æ—¶åŠ è½½å¹¶å‚è€ƒæ‰§è¡Œã€‚å®ƒæ˜¯**å»ºè®®æ€§**çš„ã€‚
*   **Hooks æ˜¯å¼ºåˆ¶ Claude "å¿…é¡»åšå¯¹"**ï¼šåœ¨å…³é”®èŠ‚ç‚¹æ‰§è¡Œè„šæœ¬éªŒè¯ï¼Œä¸é€šè¿‡å°±ç‰©ç†é˜»æ­¢ç»§ç»­ã€‚å®ƒæ˜¯**ç¡®å®šæ€§**çš„ã€‚

å®è·µä¸­ä¸¤è€…å¸¸å¸¸é…åˆä½¿ç”¨ï¼šSkills æä¾›æ–¹æ³•è®ºæŒ‡å¯¼ï¼ŒHooks ç¡®ä¿æœ€ä½è´¨é‡æ ‡å‡†ã€‚

#### 2. å¯¹ 2B Agent å·¥ç¨‹çš„å‚è€ƒ
Claude Code çš„ Skills å’Œ Hooks æœºåˆ¶ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨è§£å†³ AI Agent çš„å¯æ§æ€§å’Œå¯é æ€§é—®é¢˜ï¼Œå¯¹æ„å»º 2B Agent æœ‰å¾ˆå¼ºçš„å‚è€ƒä»·å€¼ï¼š
*   **åˆ†å±‚æ§åˆ¶æ¶æ„**ï¼šSkillsï¼ˆçŸ¥è¯†å±‚ï¼‰+ Hooksï¼ˆæ§åˆ¶å±‚ï¼‰çš„è®¾è®¡åœ¨ 2B Agent ä¸­ä¹Ÿåº”åŒºåˆ†"å»ºè®®æ€§æŒ‡å¯¼"å’Œ"å¼ºåˆ¶æ€§éªŒè¯"ã€‚ä¾‹å¦‚å®¢æœ Agent å¯ä»¥æœ‰è¯æœ¯ Skillsï¼Œä½†æ•æ„Ÿä¿¡æ¯æ³„éœ²å¿…é¡»ç”¨ Hook æœºåˆ¶ç¡¬æ‹¦æˆªã€‚
*   **äººæœºååŒç•Œé¢**ï¼šHooks çš„ stdin/stderr é€šä¿¡æ¨¡å¼å±•ç¤ºäº†ä¸€ç§æ¸…æ™°çš„æ„å›¾æ³¨å…¥å’Œåé¦ˆæœºåˆ¶ã€‚åœ¨ 2B åœºæ™¯ä¸­ï¼Œå†³ç­–é€æ˜åº¦å’Œå¯è§£é‡Šæ€§è‡³å…³é‡è¦ï¼Œç±»ä¼¼çš„é€šä¿¡åè®®è®¾è®¡å¯ä»¥è®©ä¸šåŠ¡äººå‘˜ç†è§£ Agent çš„æ¯ä¸ªåˆ¤æ–­ä¾æ®ã€‚

#### 3. é¢˜å¤–è¯ï¼šå…³äºæ¨¡å‹é€‰å‹çš„é¿å‘å‚è€ƒ
æœ€è¿‘ç»å¸¸è¢«é—®åˆ°ä¸åŒä¸šåŠ¡åœºæ™¯ä¸‹çš„æ¨¡å‹é€‰å‹é—®é¢˜ã€‚ä¸€ä¸ªæ™®éçš„è¯¯åŒºæ˜¯ï¼šå¾ˆå¤šå›¢é˜Ÿä¹ æƒ¯ç›´æ¥ç”¨å°å°ºå¯¸å¼€æºæ¨¡å‹åš POCï¼Œç»“æœé™·å…¥äº†â€œä¸çŸ¥é“æ˜¯æ¨¡å‹èƒ½åŠ›ä¸è¶³ï¼Œè¿˜æ˜¯æŠ€æœ¯æ–¹æ¡ˆæœ‰é—®é¢˜â€çš„å›°å±€ï¼Œæµªè´¹äº†å¤§é‡è°ƒè¯•æ—¶é—´ã€‚

ä¸ªäººç»éªŒå»ºè®®ï¼š
1.  **å…ˆæµ‹ä¸Šé™**ï¼šç¬¬ä¸€æ­¥ä¼˜å…ˆç”¨é¡¶çº§æ¨¡å‹ï¼ˆå¦‚ Claude Sonnet 4.5ã€GPT-5ã€Gemini 2.5 Pro ç­‰ï¼‰éªŒè¯ä¸šåŠ¡åœºæ™¯çš„å‡†ç¡®åº¦ä¸Šé™ï¼Œå¿«é€Ÿç¡®è®¤å½“å‰æŠ€æœ¯æ–¹æ¡ˆæ˜¯å¦å¯è¡Œã€‚
2.  **å†åšä¼˜åŒ–**ï¼šå‡†ç¡®åº¦éªŒè¯é€šè¿‡åï¼Œå†æ ¹æ®å®é™…éœ€æ±‚ï¼Œé€šè¿‡æ¨¡å‹é™çº§æˆ–ç®—åŠ›å‡çº§æ¥ä¼˜åŒ–å“åº”é€Ÿåº¦ã€‚
3.  **åˆ†å±‚æœåŠ¡**ï¼šæœ€åè€ƒè™‘æˆæœ¬æ§åˆ¶å’Œæœ¬åœ°åŒ–éƒ¨ç½²è¦æ±‚ï¼Œè®¾è®¡å¤§å°æ¨¡å‹åˆ†å±‚æœåŠ¡ï¼ˆè·¯ç”± + é™çº§ç­–ç•¥ï¼‰ï¼Œé’ˆå¯¹é«˜é¢‘ä½éš¾åº¦ä»»åŠ¡ä½¿ç”¨å°æ¨¡å‹ã€‚

ä¸€å¥è¯æ€»ç»“ï¼š**å…ˆç¡®ä¿"èƒ½åšåˆ°"ï¼Œå†ä¼˜åŒ–"åšå¾—å¿«"å’Œ"åšå¾—çœ"ã€‚** åƒä¸‡åˆ«åœ¨å°æ¨¡å‹ä¸Šåå¤è°ƒè¯•ï¼Œæœ€åå‘ç°æ˜¯æ¨¡å‹å¤©èŠ±æ¿çš„é—®é¢˜ã€‚

## å…³è”ä¸»é¢˜

- [[00-å…ƒè¯­/Claude]]
- [[00-å…ƒè¯­/Agent]]
- [[00-å…ƒè¯­/CI]]
- [[00-å…ƒè¯­/security]]
- [[00-å…ƒè¯­/cli]]
- [[00-å…ƒè¯­/workflow]]
- [[00-å…ƒè¯­/skills]]
